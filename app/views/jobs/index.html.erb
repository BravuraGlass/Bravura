<%- model_class = Job -%>
<h3><%=t '.title', :default => model_class.model_name.human.pluralize.titleize %>
   <small>List of existing jobs</small>
</h3>
<div class="container-fluid">
   <div class="row">
      <div id="jobListPanel" class="<%= @job.id ? 'col-lg-7' : 'col-lg-12' %> no-padding">
         <div class="panel panel-default">
            <div class="panel-heading">
            </div>
            <div class="panel-body">
              <div class="row actions-panel">
                <div class="col-xs-12 col-md-12">
                  <div class="btn-group">
                    <% if current_user.type_of_user.eql?("0") %>
                      <span>Only Active: </span>
                      <%= check_box_tag :show_active, :show_active, @show_active %>
                    <% end %>
                    <%= form_tag( jobs_path, method: :get, id: "filter-form" ) do |f| %>
                      <div data-toggle="buttons" class="btn-group">
                        <label class="btn btn-default <%= @filter_all ? 'active': '' %>">
                        <input type="radio" class="filter-button" name="filter" value="all" <%= @filter_all ? 'checked="true"': '' %>>All</label>
                        <label class="btn btn-default <%= @filter_today ? 'active': '' %>">
                        <input type="radio" class="filter-button" name="filter" value="today" <%= @filter_today ? 'checked="true"': '' %>>Today</label>
                        <label class="btn btn-default <%= @filter_tomorrow ? 'active': '' %>">
                        <input type="radio" class="filter-button" name="filter" value="tomorrow" <%= @filter_tomorrow ? 'checked="true"': '' %>>Tomorrow</label>
                        <label class="btn btn-default <%= @filter_nextweek ? 'active': '' %>">
                        <input type="radio" class="filter-button" name="filter" value="nextweek" <%= @filter_nextweek ? 'checked="true"': '' %>>Next Week</label>
                        <label class="btn btn-default <%= @filter_date ? 'active': '' %>">
                        <input type="radio" class="filter-button" name="filter" value="date" <%= @filter_date ? 'checked="true"': '' %>>Date</label>
                      </div>
                      <%= date_field("", "date", value: @selected_date, class: 'btn btn-default' ) %>
                      <%= link_to "Go", "#", {class: "btn btn-default filter-button"} %>
                    <% end %>
                  </div>
                </div>
              </div>
              <table class="datatable table table-striped table-hover responsive">
                <thead>
                  <tr>
                    <th class="sort-alpha">Date</th>
                    <th class="sort-alpha">Job</th>
                    <th class="sort-alpha">Customer</th>
                    <th class="sort-alpha">Job Status</th>
                    <th class="sort-alpha">FO Status</th>
                    <th class="no-sort">Sections Done</th>
                    <!-- <th class="no-sort">Actions</th> -->
                  </tr>
                </thead>
                <tbody>
                  <% if @jobs.nil? %>
                    <tr>
                      <td colspan="7">There are no jobs matching the criteria</td>
                    </tr>
                    <% else %>
                      <% @jobs.each do |job| %>
                        <tr onclick="location.href = '<%=job_path(job)%>'" class="pointer <%= 'selected' if (job.id == @job.id) %>">
                          <td>
                            <%= l(job.appointment, format: '%Y/%m/%d') if job.appointment %>
                          </td>
                          <td>
                            <span>(<%= job.id %>) <%= job.address.nil? ? "empty" : job.address[0...30] %></span>
                            <% job.comments[0..1].each do |c| %>
                              <div class="comment">
                                <span class="comment-date"><%= l(c.created_at, format: :short) %>,</span>
                                <span class="comment-author"><%= c.user.first_name %> </span>said:
                                <%= c.body %>
                              </div>
                              <% end %>
                          </td>
                          <td title="<%= job.customer.contact_details %>">
                            <%= job.customer.contact_info %>
                          </td>
                          <td>
                            <%= job.status %>
                          </td>
                          <td>
                            <%= job.fabrication_order ? job.fabrication_order.status : '' %>
                          </td>
                          <td>
                            <%
                            if job.fabrication_order
                              status = job.fabrication_order.sections_status
                              class_status = status[:done] ? 'green' : 'yellow'
                            %>
                              <span id="job-detail-<%= job.id %>" data-job-details="<%= job.fabrication_order.sections_to_json %>" class="job-detail-element <%= class_status %>"><%= "#{status[:ready]} of #{status[:total]}" %></span>
                              <% end %>
                          </td>
                        </tr>
                        <% end %>
                          <% end %>
                </tbody>
              </table>
               <%= link_to t('.new', :default => t("helpers.links.new")), new_job_path, :class => 'btn btn-primary' %>
            </div>
         </div>
      </div>
      <% if @job.id %>
      <div id="jobDetailPanel" class="col-lg-5 no-padding">
         <div class="panel panel-default">
            <div class="panel-heading job">
              Job ID # <%= @job.id %>
              <small><%= l(@job.created_at, format: :short) if @job.created_at %> <a id="closePanelButton" class="btn" href="#"><i class="fa fa-close"></i>Close</a></small>
            </div>
            <div class="panel-body">
              <div class="actions row">
                <div class="col-xs-12">
                  <%= @job.fabrication_order ?
                        link_to("View FO", edit_fabrication_order_path(@job.fabrication_order), :class => 'btn btn-default') :
                        link_to('Create FO', job_fabrication_orders_path(@job), method: :post, class: 'btn btn-default') %>
                  <%= link_to 'Print FO', f_orders_barcode_path(@job.fabrication_order), target: "_blank", :class => 'btn btn-default' if @job.fabrication_order %>

                <!-- <%= link_to 'View FO', job_fabrication_order_path(@job, @job.fabrication_order),  class: 'btn btn-default' if @job.fabrication_order %>
                <%= link_to 'Create FO', job_fabrication_orders_path(@job), method: :post, class: 'btn btn-primary'  if !@job.fabrication_order %> -->
                </div>
              </div>
              <%- job = @job %>
              <%= render :partial => 'form', locals: {readonly: false} %>

              <div class="row">
                <div class="col-lg-12">
                  <div class="panel panel-default">
                  <div class="panel-heading pointer" onclick="BRAVURA.showCustomerPanel();">Customer Information
                      <small><%= @job.customer.company_name %></small>
                    </div>
                    <div id="customerInfoPanel" class="panel-body hide">
                      <%= form_for @job.customer, :html => { :class => "customer", :role => 'form' } do |f| %>

                          <div class="form-group col-lg-6">
                            <%= f.label :contact_firstname %>
                            <%= f.text_field :contact_firstname, :class => 'form-control', id: :customer_contact_firstname %>
                          </div>
                          <div class="form-group col-lg-6">
                            <%= f.label :contact_lastname %>
                            <%= f.text_field :contact_lastname, :class => 'form-control', id: :customer_contact_lastname %>
                          </div>
                          <div class="form-group col-lg-6">
                            <%= f.label :company_name %>
                            <%= f.text_field :company_name, :class => 'form-control', id: :customer_company_name %>
                          </div>
                          <div class="form-group col-lg-6">
                            <%= f.label :email %>
                            <%= f.text_field :email, :class => 'form-control', id: :customer_email %>
                          </div>
                          <div class="form-group col-lg-6">
                            <%= f.label :email2 %>
                            <%= f.text_field :email2, :class => 'form-control', id: :customer_email2 %>
                          </div>
                          <div class="form-group col-lg-6">
                            <%= f.label :address %>
                            <%= f.text_field :address, :class => 'form-control', id: :customer_address %>
                          </div>
                          <div class="form-group col-lg-4">
                            <%= f.label :phone_number %>
                            <%= f.text_field :phone_number, :class => 'form-control', id: :customer_phone_number %>
                          </div>
                          <div class="form-group col-lg-4">
                            <%= f.label :phone_number2 %>
                            <%= f.text_field :phone_number2, :class => 'form-control', id: :customer_phone_number2 %>
                          </div>
                          <div class="form-group col-lg-4">
                            <%= f.label :fax %>
                            <%= f.text_field :fax, :class => 'form-control', id: :customer_fax %>
                          </div>
                          <div class="form-group">
                            <%= f.label :notes %>
                            <%= f.text_area :notes, :class => 'form-control', id: :customer_notes %>
                          </div>
                          <div class="actions">
                            <%= f.submit nil, :class => 'btn btn-primary' %>
                            <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                                customers_path, :class => 'btn btn-default' %>
                          </div>
                    <% end %>
                    </div>
                  </div>
                </div>
              </div>

              <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        job_path(job),
                        :method => :delete,
                        :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-xs btn-danger' if (job.id) %>
            </div>
          </div>
        </div>
      </div>
      <% end %>
    </div>
</div>
<%= render :partial => 'product_detail' %>
